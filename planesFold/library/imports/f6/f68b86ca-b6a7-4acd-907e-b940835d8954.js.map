{"version":3,"sources":["../../../../../assets/components/Options/assets/components/Options/OptionJS.js"],"names":["scDuration","cc","Class","extends","Component","properties","parent_node","Node","canMove","exchangeParent","onLoad","node","on","EventType","TOUCH_START","touch_start","bind","TOUCH_MOVE","touch_move","TOUCH_END","touch_end","TOUCH_CANCEL","touch_cancel","audioPool","self","document","addEventListener","resetState","init","gameJS","option","optionLength","opacity","startx","x","starty","y","evt","changeMoveTag","tag","playOptionAudio","dragX","dragY","zIndex","playOptionOutAudio","isTouch","check","optionClick","reloadState","delta","touch","getDelta","touches","getTouches","parentNode","parent","judgePos","convertTouchToNodeSpaceAR","Math","abs","width","height","CONSOLE_LOG_OPEN","log","isCollisioned","nodePosition","convertToWorldSpaceAR","p","newPosition","convertToNodeSpaceAR","setPosition","moveAction","moveTo","calculateAnimTime","runAction","sequence","callFunc","updateState","distance","pDistance","position","s","setZindex","sheepNode","interactable","resumeSystemEvents","pauseSystemEvents"],"mappings":"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","file":"OptionJS.js","sourceRoot":"../../../../../assets/components/Options","sourcesContent":["var scDuration = 0.2;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        parent_node: cc.Node,\n        canMove: false,\n        exchangeParent: false,\n    },\n    onLoad: function () {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.touch_start.bind(this), this.node);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touch_move.bind(this), this.node);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.touch_end.bind(this), this.node);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.touch_cancel.bind(this), this.node);\n        this.audioPool = [];\n        var self = this;\n        //等同于切后台监听\n        document.addEventListener('resignActivePauseGame', function () {\n            self.resetState();\n        });\n    },\n\n    init: function (gameJS, option, optionLength) {\n        this.node.opacity = 255;\n        this.startx = this.node.x;\n        this.starty = this.node.y;\n        this.gameJS = gameJS;\n        this.option = option; //选项（选项，选项答案）\n        // this.optionNo = option.optionNo;\n        // this.node.getComponent(cc.Sprite).spriteFrame = this.gameJS.getSpriteFrame(this.option.optioncontimg);\n\n    },\n    touch_start: function (evt) {\n        this.canMove = this.gameJS.changeMoveTag(this.node.tag);\n        if (!this.canMove) {\n            return;\n        }\n       \n        this.gameJS.playOptionAudio();\n        this.dragX = this.node.x;\n        this.dragY = this.node.y;\n        this.parent_node.zIndex = 1;\n    },\n    touch_end: function (evt) {\n        if (!this.canMove) {\n            return;\n        }\n      \n        this.gameJS.playOptionOutAudio();\n        this.node.opacity = 255;\n        var isTouch = this.check();\n        if (isTouch) {\n            this.optionClick();\n        } else {\n            this.reloadState();\n        }\n    },\n    touch_move: function (evt) {\n        if (!this.canMove) {\n            return;\n        }\n        var delta = evt.touch.getDelta();\n        this.node.x += delta.x;\n        this.node.y += delta.y;\n\n        //出屏还原\n        var touches = evt.getTouches();\n        var parentNode = this.node.parent.parent.parent;\n        var judgePos = parentNode.convertTouchToNodeSpaceAR(touches[0]);\n        if (Math.abs(judgePos.x) < (parentNode.width / 2 - 50) &&\n            Math.abs(judgePos.y) < (parentNode.height / 2 - 30)) {\n            //cc.log(\"触屏校验\" + judgePos.x + \"  \" + judgePos.y);\n        } else {\n            if (CONSOLE_LOG_OPEN) cc.log('出屏了');\n            this.reloadState();\n        }\n    },\n    touch_cancel: function (evt) {\n        if (!this.canMove) {\n            return;\n        }\n        this.reloadState();\n    },\n\n    check: function () {\n        if (CONSOLE_LOG_OPEN) cc.log('this.node.isCollisioned=' + this.node.isCollisioned);\n        return this.node.isCollisioned;\n    },\n\n    /* 切换后台恢复位置 */\n    resetState: function () {\n        //this.node.getComponent(cc.Button)._pressed = false;\n\n    },\n    reloadState: function () {\n        this.canMove = false; //防止超屏多次触发\n        //父类变换时还原父类使用\n        if (this.exchangeParent) {\n            let nodePosition = this.node.convertToWorldSpaceAR(cc.p(0, 0));\n            this.node.parent = this.parent_node;\n            let newPosition = this.node.parent.convertToNodeSpaceAR(nodePosition);\n            this.node.setPosition(newPosition);\n        }\n        //复位add\n        var moveAction = cc.moveTo(this.calculateAnimTime(), cc.p(this.startx, this.starty));\n        this.node.runAction(cc.sequence(moveAction, cc.callFunc(function () {\n            this.node.setPosition(this.startx, this.starty);\n            this.parent_node.zIndex = 0;\n            this.updateState(true);\n            this.gameJS.changeMoveTag(0);\n        }, this)));\n    },\n    //计算复位动画执行时间\n    calculateAnimTime: function () {\n        var distance = cc.pDistance(this.node.position, cc.p(this.startx, this.starty));\n        var s = distance / 1000;\n        s = s > 1 ? 1 : s;\n        return s * 0.3;\n    },\n\n    optionClick: function () {\n        if (this.exchangeParent) {\n            let nodePosition = this.node.convertToWorldSpaceAR(cc.p(0, 0));\n            this.setZindex(this.node);\n            this.node.parent = this.sheepNode;\n            let newPosition = this.node.parent.convertToNodeSpaceAR(nodePosition);\n            this.node.setPosition(newPosition);\n        }\n\n        this.node.parent.zIndex = 0;\n        this.canMove = false;\n        this.gameJS.changeMoveTag(0);\n\n    },\n    /*node禁止触摸事件 \n     */\n    updateState: function (interactable) {\n        if (interactable) {\n            this.node.resumeSystemEvents(true);\n        } else {\n            this.node.pauseSystemEvents(true);\n        }\n    },\n\n   \n});"]}