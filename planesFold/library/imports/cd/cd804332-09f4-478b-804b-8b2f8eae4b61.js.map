{"version":3,"sources":["../../../../assets/base/assets/base/NetworkJS.js"],"names":["NetworkJS","cc","Class","extends","Component","properties","GetQueryString","name","reg","RegExp","r","window","location","search","substr","match","decodeURI","sendXHR","racingjs","xhr","loader","getXMLHttpRequest","streamXHREventsToLabel","fileUrl","open","sys","isNative","setRequestHeader","timeout","send","method","responseHandler","handler","response","substring","self","onreadystatechange","readyState","XMLHttpRequest","DONE","CONSOLE_LOG_OPEN","console","log","responseText","status","analysisData","gameLoadFailed","questions","JSON","parse","length","questionArr","i","question","analysisDict","push","setPlatform","setGameName","startLoadGame","gameLoadSuccess","questionDict","interactiveJson","answerTime","levelQuestionDetailID","questionid","leveLQuestionDetailNum","orderid","qescont","removeSpan","spanString","newStr","replace","type","params","encodeURI","href","totalNumber","gameOver","answerInfoArr","data","stringify","gameLoadProgress","nowNumber"],"mappings":"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","file":"NetworkJS.js","sourceRoot":"../../../../assets/base","sourcesContent":["var NetworkJS = cc.Class({\n\textends: cc.Component,\n\n\tproperties: {\n\t},\n\n\t//解析url参数\n\tGetQueryString: function (name) {\n\t\tvar reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n\t\tvar r = window.location.search.substr(1).match(reg);\n\t\tif (r != null) return decodeURI(r[2]); return null;\n\t},\n\n\tsendXHR: function (racingjs) {\n\t\tthis.racingjs = racingjs;\n\t\tvar xhr = cc.loader.getXMLHttpRequest();\n\t\tthis.streamXHREventsToLabel(xhr, 'GET');\n\t\t//题库\n\t\tvar fileUrl = this.GetQueryString('fileUrl');\n\t\txhr.open(\"GET\", fileUrl);\n\t\tif (cc.sys.isNative) {\n\t\t\txhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\n\t\t}\n\t\txhr.timeout = 60000;//timeout\n\t\txhr.send();\n\t},\n\n\tstreamXHREventsToLabel: function (xhr, method, responseHandler) {\n\t\tvar handler = responseHandler || function (response) {\n\t\t\treturn method + \" Response: \" + response.substring(0, 30) + '...';\n\t\t};\n\t\tvar self = this;\n\t\t// Special event\n\t\txhr.onreadystatechange = function () {\n\t\t\t// try {\n\t\t\t\tif (xhr.readyState === XMLHttpRequest.DONE) {\n\t\t\t\t\tif (CONSOLE_LOG_OPEN) console.log(handler(xhr.responseText));\n\t\t\t\t\tif (xhr.status === 200) {\n\t\t\t\t\t\t// self.hideProgressBar();\n\t\t\t\t\t\tself.analysisData(xhr.responseText);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (CONSOLE_LOG_OPEN) console.log('There was a problem with the request.');\n\t\t\t\t\t\t//下载失败反馈结果\n\t\t\t\t\t\tself.gameLoadFailed(1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t// }\n\t\t\t// catch (e) {\n\t\t\t\t// if (CONSOLE_LOG_OPEN) console.log('Caught Exception: ' + e.description);\n\t\t\t\t//下载失败反馈结果\n\t\t\t\t//self.gameLoadFailed(1);\n\t\t\t// }\n\t\t};\n\t},\n\n\t//解析数据\n\tanalysisData: function (responseText) {\n\t\tvar questions = JSON.parse(responseText);\n\t\tif (questions || questions.length > 0) {\n\t\t\tvar questionArr = [];\n\t\t\tfor (var i = 0; i < questions.length; ++i) {\n\t\t\t\tvar question = this.analysisDict(questions[i]);\n\t\t\t\tif (!question) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tquestionArr.push(question);\n\t\t\t}\n\t\t\tif (questionArr && questionArr.length > 0 && questions.length == questionArr.length) {\n\t\t\t\tthis.racingjs.setPlatform(this.GetQueryString('platform'));\n\t\t\t\tthis.racingjs.setGameName(this.GetQueryString('gameName'));\n\t\t\t\tthis.racingjs.startLoadGame(questionArr);\n\t\t\t\t//通知游戏加载成功，开始游戏\n\t\t\t\tthis.gameLoadSuccess(questionArr.length);\n\t\t\t} else {\n\t\t\t\tthis.gameLoadFailed(2);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.gameLoadFailed(2);\n\t\t}\n\t},\n\t//解析转换每一条数据\n\tanalysisDict: function (questionDict) {\n\t\tvar interactiveJson = questionDict.interactiveJson;\n\t\tif (!interactiveJson || interactiveJson.length == 0) {\n\t\t\t//容错不录json的情况\n\t\t\tthis.gameLoadFailed(2);\n\t\t\treturn;\n\t\t} else if (typeof interactiveJson == 'string') {\n\t\t\tinteractiveJson = JSON.parse(interactiveJson);\n\t\t}\n\t\t//每一道小题内容\n\t\tvar question = {\n\t\t\tanswerTime: '0',//答题时间\n\t\t\tlevelQuestionDetailID: questionDict.questionid,//IPS题目（小题） ID\n\t\t\tleveLQuestionDetailNum: questionDict.orderid,//IPS题目（小题）序号\n\t\t\tqescont: this.removeSpan(questionDict.qescont),//题干\n\t\t\tinteractiveJson: interactiveJson,//格外配置json\n\t\t};\n\n\t\treturn question;\n\t},\n\n\t//过滤标签\n\tremoveSpan: function (spanString) {\n\t\tvar newStr = spanString.replace('<span>', '');\n\t\tnewStr = newStr.replace('</span>', '');\n\t\treturn newStr;\n\t},\n\t//下载解析失败type:1.下载失败，2.解析失败\n\tgameLoadFailed: function (type) {\n\t\tif (type == 1) {\n\t\t\tvar params = encodeURI('errcode=10001&errmsg=下载失败');\n\t\t\twindow.location.href = 'optionBlank://gameLoadFailed?' + params;\n\t\t} else {\n\t\t\tvar params = encodeURI('errcode=10002&errmsg=解析失败');\n\t\t\twindow.location.href = 'optionBlank://gameLoadFailed?' + params;\n\t\t}\n\t},\n\t//通知游戏加载成功，开始游戏\n\tgameLoadSuccess: function (totalNumber) {\n\t\tvar params = encodeURI('isShow=1&totalNumber=' + totalNumber);\n        window.location.href = 'optionBlank://gameLoadSuccess?' + params;\n\t},\n\t//通知游戏结束\n\tgameOver: function (answerInfoArr) {\n\t\tvar data = encodeURI(JSON.stringify(answerInfoArr));\n\t\twindow.location.href = 'optionBlank://gameOver?status=1&data=' + data;\n\t},\n\t//通知游戏加载成功，开始游戏\n    gameLoadProgress: function (nowNumber, totalNumber) {\n        var params = encodeURI('nowNumber=' + nowNumber + '&totalNumber=' + totalNumber);\n        window.location.href = 'optionBlank://gameLoadProgress?' + params;\n    },\n\n});\n"]}