{"version":3,"sources":["numSpineJs.js"],"names":["spineWidth","miWidth","stateArray","cc","Class","extends","Component","properties","spine0","Prefab","spine1","spine2","spine3","spine4","spine5","spine6","spine7","spine8","spine9","onLoad","stand","number","init","num","toString","i","length","charAt","spinePre","instantiate","node","addChild","position","p","getComponent","findBone","x","y","setStand","state","numState","index","setAnimation","showYinying","isShow","children","forEach","obj","idx","getChildByName","active","getStand","getNumber","getEyseParent","convertToWorldSpaceAR","getEyseRotatePos","pos","Epos","shootVector","normalizedVector","pNormalize","distance","pDistance","scale","Math","min","tpos","pAdd","pMult","setEysePos","lpos","resetEyePos"],"mappings":"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","file":"numSpineJs.js","sourceRoot":"../../../../../assets/components/script","sourcesContent":["// // 类型 0为骨骼 1为纹理\n// let numType = cc.Enum({\n//     SPINE   : 0,\n//     SPRITE   : 1,\n\n// });\n//骨骼状态\nlet spineWidth = 150 \nlet miWidth = 10 \n\nlet stateArray = [\n    \"stand\", //常态 站立\n    \"grasp\", //拖拽状态\n    \"happy\", //开心\n    \"happy_coterie\", //开心定制\n    \"sad\", // 悲哀\n    \"jump\", // 跳跃\n    \"original_number\" // 数字形态\n]\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // 数字骨骼预制\n        spine0 : cc.Prefab,\n        spine1 : cc.Prefab,\n        spine2 : cc.Prefab,\n        spine3 : cc.Prefab,\n        spine4 : cc.Prefab,\n        spine5 : cc.Prefab,\n        spine6 : cc.Prefab,\n        spine7 : cc.Prefab,\n        spine8 : cc.Prefab,\n        spine9 : cc.Prefab,\n    },\n    // stand 用于记录骨骼状态， type 用于记录类型， 显示骨骼还是精灵\n    onLoad: function () {\n        //状态\n        this.stand = null\n        this.number = null \n    },\n    // num  type string  传入数字\n    init:function (num) {\n        num = num.toString()\n        this.number = num \n        if (typeof(num) == \"string\") {\n            for(let i=0;i<num.length;i++){\n                let number  = num.charAt(i)\n                let spinePre = cc.instantiate(this[\"spine\"+number]);\n                this.node.addChild(spinePre)\n                spinePre.position = cc.p(-num.length/2*(spineWidth+miWidth)+i*(spineWidth+miWidth)+miWidth/2+spineWidth/2, 0);\n                this[\"spine\"+number +i] = spinePre.getComponent(\"sp.Skeleton\")\n                this[\"spineEyel\"+number +i] = this[\"spine\"+number +i].findBone(\"eye_l\")\n                this[\"spineEyer\"+number +i] = this[\"spine\"+number +i].findBone(\"eye_r\")\n                this[\"_Eyelx\"+number +i] =  this[\"spineEyel\"+number +i].x\n                this[\"_Eyely\"+number +i] =  this[\"spineEyer\"+number +i].y\n                \n            }\n        }\n        this.setStand(0)\n\n    },\n    // 设置状态动画  支持字符串 和下标  例子 setStand(1) setStand(\"happy\")\n    setStand :function (state) {\n        let numState = null \n        if (typeof(state) == \"string\") {\n            for (let index = 0; index < stateArray.length; index++) {\n                if (stateArray[index] == state) {\n                    numState = state\n                    break;\n                }\n                \n            }\n        }else if  (typeof(state) == \"number\"){\n            numState = stateArray[state]\n        }else{\n            return\n        }\n        if (numState && numState != this.stand) {\n            this.stand = numState\n            for(let i=0;i<this.number.length;i++){\n                let number  = this.number.charAt(i)\n                this[\"spineEyel\"+number +i].x =  this[\"_Eyelx\"+number +i]\n                this[\"spineEyel\"+number +i].y =  this[\"_Eyely\"+number +i]\n                this[\"spineEyer\"+number +i].x =  this[\"_Eyelx\"+number +i]\n                this[\"spineEyer\"+number +i].y =  this[\"_Eyely\"+number +i]\n                this[\"spine\"+number +i].setAnimation(0,numState,true)\n            }\n        }\n        // this.node.children.forEach((obj, idx)=> {\n        //     obj.getChildByName('yinying').active = this.stand !== \"grasp\" && this.stand !== \"original_number\"\n        // },this);\n        \n        // this.yySp.active = this.stand !== \"grasp\" && this.stand !== \"original_number\"\n\n    },\n    //是否显示阴影\n    showYinying: function(isShow) {\n     \n     this.node.children.forEach((obj, idx)=> {\n        obj.getChildByName('yinying') && (obj.getChildByName('yinying').active = isShow);\n    },this);\n\n    },\n    \n    getStand :function () {\n        return this.stand || \"\"\n    },\n\n    getNumber :function () {\n        return this.number || \"\"\n    },\n\n    //获取父类 世界坐标\n    getEyseParent :function () {\n        return this.node.convertToWorldSpaceAR(cc.p(0,0))\n    },\n    // 获取偏移位置点\n    getEyseRotatePos :function (pos,Epos) {\n        let shootVector = cc.p(pos.x - Epos.x ,pos.y - Epos.y)\n        // //向量标准化(即向量长度为1)  \n        let normalizedVector = cc.pNormalize(shootVector) ; \n   \n        let distance =  cc.pDistance(Epos, cc.p(pos.x,pos.y));\n        let scale = Math.min(2 * (distance / 70),10) \n        let tpos = cc.pAdd(cc.p(0,0),cc.pMult(normalizedVector,scale))        \n        return tpos\n    },\n    // 眼睛跟随手指位置\n    setEysePos :function (pos) {\n        // 不是站立状态不执行\n        if (this.stand !== \"stand\") {\n            return\n        }\n        let lpos =  this.getEyseRotatePos(pos,this.getEyseParent())\n        for(let i=0;i<this.number.length;i++){\n            let number  = this.number.charAt(i)\n            if (this[\"spineEyel\"+number +i] && this[\"spineEyer\"+number +i]) {\n                this[\"spineEyel\"+number +i].x = -lpos.y + this[\"_Eyelx\"+number +i]\n                this[\"spineEyel\"+number +i].y = lpos.x + this[\"_Eyely\"+number +i]\n                this[\"spineEyer\"+number +i].x = -lpos.y + this[\"_Eyelx\"+number +i]\n                this[\"spineEyer\"+number +i].y = lpos.x + this[\"_Eyely\"+number +i]\n            }\n        }\n    },\n    resetEyePos :function () {\n        for(let i=0;i<this.number.length;i++){\n            let number  = this.number.charAt(i)\n            if (this[\"spineEyel\"+number +i] && this[\"spineEyer\"+number +i]) {\n                this[\"spineEyel\"+number +i].x = this[\"_Eyelx\"+number +i]\n                this[\"spineEyel\"+number +i].y = this[\"_Eyely\"+number +i]\n                this[\"spineEyer\"+number +i].x = this[\"_Eyelx\"+number +i]\n                this[\"spineEyer\"+number +i].y = this[\"_Eyely\"+number +i]\n            }\n        }\n    }\n\n    // called every frame, uncomment this function to activate update callback\n});\n"]}