{"version":3,"sources":["MoveThing.js"],"names":["cc","Class","extends","Component","properties","thing","Node","gameJS","onCollisionEnter","other","self","collideAble","__lastCollisionTime","Date","getTime","node","tag","moveAble","_t","rightAnimation","hasSameTypeThing","parent","getComponent","setAnimation","active","progressJS","progress","isWin","console","log","nowQuestionID","playFlayStar","getPosition","setTimeout","selectAnswer","currTouchOption","resetPosition","runAnimation","call","wrongAnswerNum","onLoad","start","callback","pos","convertToWorldSpaceAR","v2","scaleNode","convertToNodeSpaceAR","move","moveTo","calculateAnimTime","x","y","runAction","sequence","callFunc","convertToWorldSpace","setPosition","opacity","getChildByName","moveDown","moveBy","easing","easeCubicActionOut","moveUp","easeCubicActionIn","ismoving","containers","children","i","length","monkey","giraffe","frog","distance","pDistance","position","p","s","otherPos","jump","jumpDown","zIndex","removeThingByContainerTag","rightAnswerNum"],"mappings":"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","file":"MoveThing.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        thing:cc.Node,\n        gameJS:null,\n    },\n    onCollisionEnter:function(other,self){\n        if(!this.gameJS.collideAble || this.__lastCollisionTime && new Date().getTime() - this.__lastCollisionTime < 1000)return;\n        this.__lastCollisionTime = new Date().getTime();\n        if(other.node.tag === self.node.tag){ //答对了\n            this.moveAble = false;\n            var _t = this;\n            this.rightAnimation(other,self,()=>{\n                if(!this.hasSameTypeThing(self.node.tag)){\n                    other.node.parent.getComponent(\"sp.Skeleton\").setAnimation(0,\"settle_accounts\",false);//出场\n                    other.node.tag = -1;\n                    other.node.active = false;\n                    var progressJS = this.gameJS.progress.getComponent(\"ProgressJs\");\n                    if(_t.isWin()){\n                        console.log(\"第\"+(this.gameJS.nowQuestionID+1) + \"题答对了\");\n                        progressJS.playFlayStar(other.node.getPosition(),_t.gameJS.nowQuestionID,1) //飞星方法\n                        setTimeout(()=>{\n                            _t.gameJS.selectAnswer(true);\n                        },6000);\n                    }\n                }\n                this.gameJS.currTouchOption = null;\n            });\n        }else{ //答错了\n            this.moveAble = true;\n            this.resetPosition(()=>{\n                this.gameJS.currTouchOption = null;\n            });\n            this.gameJS.runAnimation.call(this.gameJS,\"error\");\n            this.gameJS.wrongAnswerNum++;\n        }\n    },\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        \n    },\n\n    start () {\n\n    },\n    resetPosition:function(callback){\n        if(!this.thing||!this.thing.parent)return;\n        var pos = this.thing.convertToWorldSpaceAR(cc.v2(0,0));\n        pos = this.gameJS.scaleNode.convertToNodeSpaceAR(pos);\n        var move = cc.moveTo(this.calculateAnimTime(),pos.x,pos.y);\n        this.node.runAction(cc.sequence(move,cc.callFunc(()=>{\n            if(!this.thing||!this.thing.parent)return;\n            var pos = this.thing.convertToWorldSpace(cc.v2(0,0));\n            this.node.setPosition(pos);\n            this.thing.opacity = 255;\n            this.node.opacity = 0;\n            this.thing.parent.getChildByName('leaf').getComponent(\"sp.Skeleton\").setAnimation(0,\"error\",false);\n            var moveDown = cc.moveBy(0.4,0,-46).easing(cc.easeCubicActionOut());\n            var moveUp = cc.moveBy(0.5,0,46).easing(cc.easeCubicActionIn());\n            this.thing.runAction(cc.sequence(moveDown,moveUp));\n            console.log(\"resetPosition\" + this.node.ismoving);\n            if(typeof callback === \"function\")callback();\n        })),this);\n    },\n    hasSameTypeThing:function(tag){\n        var containers = this.thing.parent.parent.children;\n        var thing = null;\n        for(let i=0;i<containers.length;i++){\n            thing = containers[i].getChildByName('leaf').getChildByName('thing');\n            if(thing && thing!== this.thing && thing.tag === tag){\n                return true;\n            }\n        }\n        return false;\n    },\n    isWin:function(){\n        var monkey = this.gameJS.monkey,giraffe = this.gameJS.giraffe,frog = this.gameJS.frog;\n        return monkey.getChildByName(\"collisionNode\").tag === -1 && giraffe.getChildByName(\"collisionNode\").tag === -1 && frog.getChildByName(\"collisionNode\").tag === -1;\n    },\n        //计算复位动画执行时间\n    calculateAnimTime: function () {\n        var distance = cc.pDistance(this.node.position, cc.p(this.thing.x, this.thing.y));\n        var s = distance / 1000;\n        s = s > 1 ? 1 : s;\n        return s * 0.6;\n    },\n    rightAnimation:function(other,self,callback){ //\n        var otherPos = other.node.convertToWorldSpaceAR(cc.v2(0,0));\n        otherPos = this.gameJS.scaleNode.convertToNodeSpaceAR(otherPos);\n\n        var jump = cc.moveTo(0.3,otherPos.x,otherPos.y+300,600,1);\n        var jumpDown = cc.moveTo(0.3,otherPos.x,otherPos.y,400,1);\n        self.node.runAction(cc.sequence(jump,cc.callFunc(()=>{\n            self.node.zIndex = -1;\n        }),\n        jumpDown,\n        cc.callFunc(()=>{\n            self.node.opacity = 0;\n            self.node.zIndex = 0;\n            this.gameJS.removeThingByContainerTag.call(this.gameJS,this.thing.parent.tag);\n            this.gameJS.runAnimation.call(this.gameJS,\"right\",1400);\n            this.gameJS.rightAnswerNum++;\n            this.resetPosition();\n            if(typeof callback === 'function')callback();\n        })),this);\n    }\n    // update (dt) {},\n});\n"]}